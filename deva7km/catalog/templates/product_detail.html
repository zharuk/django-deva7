{% extends 'base.html' %}
{% load static i18n %}
{% load i18n %}

{% block title %}{% translate product.title %}{% endblock %}

{% block breadcrumbs %}
    <!-- Хлебные крошки для страницы товара -->
    <nav aria-label="breadcrumb" style="margin-top: 5px;">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">{% translate 'Главная' %}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'category_detail' product.category.slug %}">{{ product.category.name }}</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
        </ol>
    </nav>
{% endblock %}

{% block content %}

<script>
    // Отправка события ViewContent
    fbq('track', 'ViewContent', {
        content_ids: ['{{ product.sku }}'], // ID товара
        content_type: 'product', // Тип контента (в данном случае, это товар)
        content_name: '{{ product.title }}', // Название товара
        content_category: '{{ product.category.name }}', // Категория товара
        value: {{ product.price }}, // Цена товара (можно передать другие данные, такие как цена, валюта и т. д.)
        currency: '{{ product.currency }}' // Валюта товара
    });
</script>

{% if product.is_sale and product.sale_price > 0 %}
    <span class="badge bg-danger" style="font-size: 1em; margin-left: 5px;">
        <span class="text-white">{% translate 'Распродажа' %}</span>
    </span>
{% endif %}
<div class="product-details">
    <h1>{{ product.title }}</h1>
    <p><strong>{% translate 'Категория' %}:</strong> <a href="{% url 'category_detail' product.category.slug %}">{{ product.category.name }}</a></p>
    <p><strong>{% translate 'Описание' %}:</strong> {{ product.description }}</p>
    <p><strong>{% translate 'Артикул' %}:</strong> {{ product.sku }}</p>
    <p><strong>{% translate 'Цвета' %}:</strong>
        {% for color in product.colors.all %}
            {{ color.name }},
        {% empty %}
            {% translate 'Нет данных' %}
        {% endfor %}
    </p>
    <p><strong>{% translate 'Размеры' %}:</strong>
        {% for size in product.sizes.all %}
            {{ size.name }},
        {% empty %}
            {% translate 'Нет данных' %}
        {% endfor %}
    </p>
    <div class="card-text">
        {% if product.is_sale and product.sale_price > 0 %}
            <p class="text-danger">
                {% if product.price > 0 %}
                    <del>{% translate 'Цена' %}: {{ product.price }} {{ product.currency }}</del><br>
                {% endif %}
                <strong>{% translate 'Цена распродажи' %}: {{ product.sale_price }} {{ product.currency }}</strong>
            </p>
        {% else %}
            <p>
                {% if product.price > 0 %}
                    <strong>{% translate 'Цена' %}: {{ product.price }} {{ product.currency }}</strong>
                {% endif %}
            </p>
        {% endif %}
    </div>
</div>

<!-- Отображение таблицы с модификациями товара -->
<div class="product-modifications">
    <h2>{% translate 'Остатки' %}</h2>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">{% translate 'Цвет' %}</th>
                <th scope="col">{% translate 'Размер' %}</th>
                <th scope="col">{% translate 'Наличие' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for modification in modifications %}
                <tr class="{% if modification.stock > 3 %}table-success{% elif modification.stock > 0 %}table-warning{% else %}table-danger{% endif %}">
                    <td>{{ modification.color.name }}</td>
                    <td>{{ modification.size.name }}</td>
                    <td>
                        {% if modification.stock > 3 %}
                            {% translate 'В наличии' %}
                        {% elif modification.stock > 0 %}
                            {% translate 'Заканчивается' %}
                        {% else %}
                            {% translate 'Нет в наличии' %}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="alert alert-dismissible alert-primary">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  {% translate 'Отправка посылки по предоплате 150грн. или полной предоплате на счет ФОП. Отправляем новой почтой или укрпочтой на ваш выбор.' %}

</div>

<!-- Кнопки купить -->
<div class="btn-group row" role="group" aria-label="Basic checkbox toggle button group">
    <a href="https://t.me/divaua" class="btn btn-outline btn-sm col-md-auto" style="background-color: #0088cc; color: white; margin: 3px;">
        <i class="fab fa-telegram fa-xl"></i> {% translate 'Купить в Telegram' %}
    </a>
    <a href="viber://chat?number=%2B380635622568" class="btn btn-outline btn-sm col-md-auto" style="background-color: #665CAC; color: white; margin: 3px;">
        <i class="fab fa-viber fa-xl"></i> {% translate 'Купить в Viber' %}
    </a>
    <a href="https://m.me/432162513828457?text={% trans 'Добрый день! Меня интересует' %} {{ product_url }}" class="btn btn-outline btn-sm col-md-auto" style="background-color: #0084FF; color: white; margin: 3px;">
        <i class="fa-brands fa-facebook-messenger fa-xl"></i> {% translate 'Купить в Messenger' %}
    </a>
    <a href="https://ig.me/m/deva7km" class="btn btn-outline btn-sm col-md-auto" style="background-color: #E4405F; color: white; margin: 3px;">
        <i class="fa-brands fa-instagram fa-xl"></i> {% translate 'Купить в Instagram' %}
    </a>
</div>


<!-- Отображение изображений товара -->
<div class="product-image" style="margin-top: 30px;">
    <h2>{% translate 'Изображения' %}</h2>
    {% for color, images in unique_color_images.items %}
        <h3>{% translate color %}</h3>
        {% for image in images %}
            <img src="{{ image.large_image.url }}" alt="{{ product.title }}" class="img-fluid d-block my-3">
        {% endfor %}
    {% empty %}
        <p>{% translate 'Нет изображений' %}</p>
    {% endfor %}
</div>

{% endblock %}

