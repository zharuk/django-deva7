<!-- templates/product_search.html -->
{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans 'Поиск товаров' %}{% endblock %}

{% block content %}
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <h1 class="text-center mb-4">{% trans 'Поиск товаров' %}</h1>
                <form method="get" action="{% url 'product_search' %}" class="form-inline justify-content-center">
                    <div class="form-group mr-3 ml-3">
                        {{ form.as_p }}
                    </div>
                    <button type="submit" class="btn btn-primary">{% trans 'Поиск' %}</button>
                </form>
            </div>
        </div>
    </div>

    {% if results %}
        <h2>{% trans 'Результаты поиска:' %}</h2>
        <div class="row">
            {% for product in results %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 position-relative">
                        {% if product.is_sale and product.retail_sale_price > 0 %}
                            <span class="badge bg-danger position-absolute top-0 start-0 m-2">
                                <span class="text-white">{% trans 'Распродажа' %}</span>
                            </span>
                        {% endif %}
                        <a href="{{ product.get_absolute_url }}">
                            <div class="card-img-top img-fluid align-self-stretch" style="height: 300px; overflow: hidden; display: flex; align-items: center;">
                                {% if product.collage_image_url %}
                                    <img src="{{ product.collage_image_url }}" class="img-fluid mx-auto" alt="{{ product.title }}" style="max-height: 100%; margin-top: 5px;">
                                {% else %}
                                    <div class="w-100 text-center">
                                        <p>{% trans 'Нет изображения' %}</p>
                                    </div>
                                {% endif %}
                            </div>
                        </a>
                        <div class="card-body">
                            <h5 class="card-title">
                                <a href="{{ product.get_absolute_url }}">{{ product.title }}</a>
                            </h5>
                            <div class="card-text">
                                <p>{% trans 'Артикул:' %} {{ product.sku }}</p>
                                <p>{% trans 'Цвета:' %} {{ product.get_colors }}</p>
                                <p>{% trans 'Размеры:' %} {{ product.get_sizes }}</p>
                                {% if product.is_sale and product.retail_sale_price > 0 %}
                                    <p class="text-danger">
                                        {% if product.retail_price > 0 %}
                                            <del>{% trans 'цена:' %} {{ product.retail_price }} {{ product.currency }}</del><br>
                                        {% endif %}
                                        <strong>{% trans 'цена распродажи:' %} {{ product.retail_sale_price }} {{ product.currency }}</strong>
                                    </p>
                                {% else %}
                                    <p>
                                        {% if product.retail_price > 0 %}
                                            <strong>{% trans 'цена:' %} {{ product.retail_price }} {{ product.currency }}</strong>
                                        {% endif %}
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="card-footer">
                            <a href="{{ product.get_absolute_url }}" class="btn btn-primary w-100">{% trans 'Перейти' %}</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>{% trans 'Ничего не найдено' %}</p>
    {% endif %}
{% endblock %}